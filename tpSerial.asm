10 ORG 100H
20 JP MAIN
30WRASR EQU 0BFAFH
40PUTSTR EQU 0BFF1H
50INKEY EQU 089BEH
60PUTCHR EQU 0BE62H
70INITSR EQU 0871AH
80AOUT EQU 0BD09H
90OPENSR EQU 0BCE8H
100CLOSSR EQU 0BCEBH
110LRDSR EQU 0BD15H
120WAITK EQU 0BFCDH
130WCHRSR EQU 0BFAFH
140WSTSR EQU 0BFB2H
150A2HEX EQU 0F9BDH
160RPTCHR EQU 0BFEEH

200MAIN: CALL INITSR
210 CALL OPENSR
220 CALL CLS
230 LD HL, GREET
240 CALL STRLN
250 LD HL, GREET
260 LD DE, 00004H
270 CALL PUTSTR
280 LD HL, GREET
290 CALL WSTSR
300 LD HL, MENUM0
310 CALL STRLN
320 LD HL, MENUM0
330 LD DE, 00100H
340 CALL PUTSTR
350MAIN0: CALL WAITK
360 CALL MX2KEY
370 CP 'Q' ; quit
380 JP Z, THEEND

900THEEND: CALL CLOSSR
910 CALL CLS
920 LD HL, ZOIGIN
930 CALL STRLN
940 LD HL, ZOIGIN
950 LD DE, 0
960 CALL PUTSTR
970 RET

3000CLS: LD B, 144
3010 LD DE, 0
3020CLS0: LD A, 32
3030 CALL RPTCHR
3040 RET
3050CLLN: LD B,24
3060 LD E,0
3070 JP CLS0
3080BYTE: PUSH AF
3090 AND 0F0H
3100 RRCA
3110 RRCA
3120 RRCA
3130 RRCA
3140 CALL NIBBLE
3150 INC HL
3160 POP AF
3170 AND 15
3180 CALL NIBBLE
3190 INC HL
3200 RET
3210NIBBLE: SUB 10
3220 JP M, ZERO9
3230 ADD A, 7
3240ZERO9: ADD A, 58
3250 LD (HL), A
3260 RET
3270STRLN: LD B, 0
3280STRLN0: LD A, (HL)
3290 CP 0
3300 JP Z, STRLN1
3310 INC HL
3320 INC B
3330 JP STRLN0
3340STRLN1: RET
3350MX2KEY: LD B,0
3360 LD C,A ; A IS KEY INDEX
3370 LD HL, MATRIX
3380 ADD HL, BC
3390 LD A,(HL)
3400 RET

5000GREET: DB '- Serial App -',13,10,0
5010MENUM0: DB '[q]uit',13,10,0
5020ZOIGIN: DB 'Bye...',13,10,0
5030MATRIX: DB 0,0FFH
5040 DB 'QWERTYUASDFGHJKZXCVBNM,'
5050 DB 0FFH,0FFH,0FFH,0FFH,9,32,10,11,14,15 ; LEFT RIGHT UP DOWN
5060 DB 0FFH, '0.=+',13,'L;',0FFH,'123-'
5070 DB 0FFH,'IO',0FFH,'456*',0FFH,'P',8,0FFH,'789/)'
5080 DB 0FFH,0FFH,0FFH,0FFH,'(',0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH
5090 DB 0,12,0FFH


