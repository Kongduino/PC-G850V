10 ORG 100H
20 JP START

30LDPSTR EQU 0BD00H
40GPF EQU 0BFD0H
50PUTSTR EQU 0BFF1H
60WAITK EQU 0BCFDH
70RPTCHR EQU 0BFEEH

100START: CALL CLS
103 LD HL,GREET
104 CALL STRLN
105 LD DE, 0500H
106 CALL PUTSTR

110MAIN: CALL WAITK
120 JP Z, MAIN ; wait for a key
130 CP 51H ; ON
140 JP Z, LEAVE
150 CP 01H ; OFF
160 JP Z, LEAVE
170 CP 50H ; CLS
180 JP Z, LEAVE
190 CALL MX2KEY ; convert
200 ; CALL CLS
210 LD HL,TMP
220 LD (HL),A
230 LD B,1
240 LD DE,0
250 CALL PUTSTR ; display
260 LD B,5 ; 5 columns
270 LD DE,00H ; x:y
280 LD HL,PIXELS
290 CALL LDPSTR ; scan screen
300 XOR A
310 LD (LINE),A
320MAIN0: LD A,5 ; 5 columns
325 LD (PIXEL),A
330 LD DE,PIXELS
350 LD HL,BUFF ; pattern storage
360 LD B,20
370 XOR A
380ZEROBF: LD (HL),A
390 INC HL
400 DJNZ ZEROBF ; zero BUFF
410 LD HL,BUFF
420MAIN2: LD A,(DE)
430 AND 3 ; 00XX
440 CALL PATRN ; get pattern
620 LD (HL),A
630 INC HL
640 LD (HL),A
650 INC HL
660 LD (HL),A
670 INC HL ; 3 columns
680 XOR A
690 LD (HL),A
700 INC HL ; 1 blank column
710 LD A,(DE)
720 RRCA
730 RRCA
740 LD (DE),A ; DE >>2
750 INC DE
930 LD A,(PIXEL)
940 DEC A
950 LD (PIXEL),A
960 CP 0
970 JP NZ,MAIN2 ; loop

980 LD B,20 ; 20 columns
990 LD E,2 ; x=2
1000 LD A,(LINE)
1010 LD D,A ; y=line
1020 INC A
1030 LD (LINE),A ; increase line
1035 LD HL,BUFF
1040 CALL GPF

1050 LD A,(LINE)
1060 CP 4
1070 JP NZ,MAIN0
1080 JP MAIN

1090LEAVE: LD HL,ZOIGIN
1100 CALL STRLN
1110 LD HL, ZOIGIN
1120 LD DE, 0
1130 CALL PUTSTR
1140 RET

1150PATRN: LD B,0
1160 CP 0 ; A=0? skip
1170 JP Z,SUITE0
1180 CP 1 ; 01
1190 JP NZ,SUITE1
1200 LD A,07H ; 0000.0111
1210 RET
1220SUITE1: CP 2 ; 10
1230 JP NZ,SUITE2
1240 LD A,70H ; 0111.0000
1250 RET
1260SUITE2: LD B,77H ; 0111.0111
1270SUITE0: LD A,B ; either 0 or 3
1280 RET

1290CLS: LD B, 144
1300 LD DE, 0
1310CLS0: LD A, 32
1320 CALL RPTCHR
1330 RET
1340CLLN: LD B,24
1350 LD E,0
1360 JP CLS0

2080STRLN: LD B,0
2090 PUSH HL
2100STRLN0: LD A,(HL)
2110 CP 0
2120 JP Z,STRLN1
2130 INC HL
2140 INC B
2150 JP STRLN0
2160STRLN1: POP HL
2170 RET

2180MX2KEY: LD B,0
2190 LD C,A ; A IS KEY INDEX
2200 LD HL, MATRIX
2210 ADD HL, BC
2220 LD A,(HL)
2230 RET

2240PIXELS: DB 0,0,0,0,0
2250BUFF: DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
2260ZOIGIN: DB 'Bye...',13,10,0
2270MATRIX: DB 0,0FFH
2280 DB 'QWERTYUASDFGHJKZXCVBNM,'
2290 DB 0FFH,0FFH,0FFH,0FFH,9,32,10,11,14,15 ; LEFT RIGHT UP DOWN
2300 DB 0FFH, '0.=+',13,'L;',0FFH,'123-'
2310 DB 0FFH,'IO',0FFH,'456*',0FFH,'P',8,0FFH,'789/)'
2320 DB 0FFH,0FFH,0FFH,0FFH,'(',0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH
2330 DB 0,12,0FFH
2340LINE: DB 0
2350COLUMN: DB 0
2360PIXEL: DB 0
2370TMP: DB 0,0,0,0
2420GREET: DB 10,'Hello...',10,0

3000BYTE: PUSH AF
3010 AND 0F0H
3020 RRCA
3030 RRCA
3040 RRCA
3050 RRCA
3060 CALL NIBBLE
3070 INC HL
3080 POP AF
3090 AND 15
3100 CALL NIBBLE
3110 INC HL
3120 RET
3130NIBBLE: SUB 10
3140 JP M,ZERO9
3150 ADD A,7
3160ZERO9: ADD A,58
3170 LD (HL),A
3180 RET

