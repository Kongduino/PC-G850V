10 ORG 100H
20 JP MAIN
30PUTSTR EQU 0BFF1H
40INKEY EQU 089BEH
50PUTCHR EQU 08440H
60INITSR EQU 0871AH
70AOUT EQU 0BD09H
80OPENSR EQU 0BCE8H
90CLOSSR EQU 0BCEBH
100LRDSR EQU 0BD15H
110WAITK EQU 0BFCDH
120WCHRSR EQU 0BFAFH
130WSTSR EQU 0BFB2H
140A2HEX EQU 0F9BDH
150RPTCHR EQU 0BFEEH
160MAIN: CALL INITSR
170 CALL OPENSR
180 CALL CLS
190 LD HL, GREET
200 CALL STRLN
210 LD A, B
220 LD HL, GREET
230 LD DE, 00004H
240 CALL PUTSTR
250 LD A, B
260 LD HL, GREET
270 CALL WSTSR
280 LD HL, MENUM0
290 CALL STRLN
300 LD HL, MENUM0
310 LD DE, 00100H
320 CALL PUTSTR
330 LD HL, MENUM1
340 CALL STRLN
350 LD HL, MENUM1
360 LD DE, 00200H
370 CALL 0BFF1H
380 LD HL, MENUM2
390 CALL STRLN
400 LD A, 24
410 DEC B
420 LD E, A
430 LD HL, MENUM2
440 LD DE, 00300H
450 CALL 0BFF1H
460MAIN0: CALL WAITK
470 CP 002H
480 JP Z, THEEND
490 CP 005H
500 JP Z, RECV

970 JP MAIN0
980THEEND: CALL CLOSSR
990 CALL CLS
1000 LD HL, ZOIGIN
1010 CALL STRLN
1020 LD HL, ZOIGIN
1030 LD DE, 0
1040 CALL 0BFF1H
1050 RET

1000RECV: LD HL, RECVMS
1010 CALL STRLN
1020 LD HL, RECVMS
1030 LD DE, 00300H
1040 CALL PUTSTR
1050 LD HL, BUFFER
1060 CALL LRDSR
1070 LD HL, BUFFER
1080 CALL STRLN
1090 LD HL, BUFFER
1100 LD DE, 00400H
1110 CALL PUTSTR
1120 LD DE, 00300H
1130 CALL CLLN
1140 JP MAIN0
1150NM2DEC: LD BC,-10000
1160 CALL NMDC1
1170 LD BC,-1000
1180 CALL NMDC1
1190 LD BC,-100
1200 CALL NMDC1
1210 LD C,-10
1220 CALL NMDC1
1230 LD C,B
1240NMDC1: LD A,-1
1250NMDC2: INC A
1260 ADD HL,BC
1270 JR C, NMDC2
1280 SBC HL,BC
1290 ADD A,48
1300 LD (DE),A
1310 INC DE
1320 RET

1330CLS: LD B, 144
1340 LD DE, 0
1350CLS0: LD A, 32
1360 CALL RPTCHR
1370 RET
1380CLLN: LD B,24
1390 LD E,0
1400 JP CLS0

1700BYTE: PUSH AF
1710 AND 0F0H
1720 RRCA
1730 RRCA
1740 RRCA
1750 RRCA
1760 CALL NIBBLE
1770 INC HL
1780 POP AF
1790 AND 15
1800 CALL NIBBLE
1810 INC HL
1820 RET
1830NIBBLE: SUB 10
1840 JP M, ZERO9
1850 ADD A, 7
1860ZERO9: ADD A, 58
1870 LD (HL), A
1880 RET
1890STRLN: LD B, 0
1900STRLN0: LD A, (HL)
1910 CP 0
1920 JP Z, STRLN1
1930 INC HL
1940 INC B
1950 JP STRLN0
1960STRLN1: RET

3000GREET: DB '- LoRa Messenger -',13,10,0
3010MENUM0: DB '[s]end    se[t]tings',13,10,0
3020MENUM1: DB '[r]eceive [q]uit',13,10,0
3030MENUM2: DB 'SELECT MENU',13,10,0
3030RECVMS: DB 'receiving...',0
3040BUFFER: DEFS 64
3050 DB 0,0,0,0
3060ZOIGIN: DB 'Bye...',13,10,0

