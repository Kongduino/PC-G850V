10 ORG 100H
20 JP MAIN
30WRASR EQU 0BFAFH
40PUTSTR EQU 0BFF1H
50INKEY EQU 089BEH
60PUTCHR EQU 08440H
70INITSR EQU 0871AH
80AOUT EQU 0BD09H
90OPENSR EQU 0BCE8H
100CLOSSR EQU 0BCEBH
110LRDSR EQU 0BD15H
120WAITK EQU 0BFCDH
130WCHRSR EQU 0BFAFH
140WSTSR EQU 0BFB2H
150A2HEX EQU 0F9BDH
160RPTCHR EQU 0BFEEH
170MAIN: CALL INITSR
180 CALL OPENSR
190 CALL CLS
200 LD HL, GREET
210 CALL STRLN
220 LD A, B
230 LD HL, GREET
240 LD DE, 00A004H
250 CALL PUTSTR
260 LD A, B
270 LD HL, GREET
280 CALL WSTSR
290 LD HL, MENUM0
300 CALL STRLN
310 LD HL, MENUM0
320 LD DE, 00100H
330 CALL PUTSTR
340 LD HL, MENUM1
350 CALL STRLN
360 LD HL, MENUM1
370 LD DE, 00200H
380 CALL PUTSTR
390 LD HL, MENUM2
400 CALL STRLN
410 LD A, 24
420 DEC B
430 LD E, A
440 LD HL, MENUM2
450 LD DE, 00300H
460 CALL PUTSTR
470MAIN0: CALL WAITK
480 CALL MX2KEY
490 CP 'Q' ; quit
500 JP Z, THEEND
510 CP 'R'
520 JP Z, RECV
530 JP MAIN0

540THEEND: CALL CLOSSR
550 CALL CLS
560 LD HL, ZOIGIN
570 CALL STRLN
580 LD HL, ZOIGIN
590 LD DE, 0
600 CALL PUTSTR
610 RET

620RECV: LD DE, 0400H
630 LD HL, RCVSTR
640 CALL STRLN
650 LD HL, RCVSTR
660 CALL PUTSTR
670 LD HL, BUFFER
680 CALL LRDSR
690 LD DE, 0400H
700 LD HL, BUFFER
710 CALL STRLN
720 LD HL, BUFFER
730 CALL PUTSTR
740 JP MAIN0

3000NM2DEC: LD BC,-10000
3010 CALL NMDC1
3020 LD BC,-1000
3030 CALL NMDC1
3040 LD BC,-100
3050 CALL NMDC1
3060 LD C,-10
3070 CALL NMDC1
3080 LD C,B
3090NMDC1: LD A,-1
3100NMDC2: INC A
3110 ADD HL,BC
3120 JR C, NMDC2
3130 SBC HL,BC
3140 ADD A,48
3150 LD (DE),A
3160 INC DE
3170 RET
3180CLS: LD B, 144
3190 LD DE, 0
3200CLS0: LD A, 32
3210 CALL RPTCHR
3220 RET
3230CLLN: LD B,24
3240 LD E,0
3250 JP CLS0
3260BYTE: PUSH AF
3270 AND 0F0H
3280 RRCA
3290 RRCA
3300 RRCA
3310 RRCA
3320 CALL NIBBLE
3330 INC HL
3340 POP AF
3350 AND 15
3360 CALL NIBBLE
3370 INC HL
3380 RET
3390NIBBLE: SUB 10
3400 JP M, ZERO9
3410 ADD A, 7
3420ZERO9: ADD A, 58
3430 LD (HL), A
3440 RET
3450STRLN: LD B, 0
3460STRLN0: LD A, (HL)
3470 CP 0
3480 JP Z, STRLN1
3490 INC HL
3500 INC B
3510 JP STRLN0
3520STRLN1: RET
3530MX2KEY: LD B,0
3540 LD C,A ; A IS KEY INDEX
3550 LD HL, MATRIX
3560 ADD HL, BC
3570 LD A,(HL)
3580 RET
3590GREET: DB '- LoRa Messenger -',13,10,0
3600MENUM0: DB '[s]end se[t]tings',13,10,0
3610MENUM1: DB '[r]eceive [q]uit',13,10,0
3620MENUM2: DB 'SELECT MENU',13,10,0
3630RECVMS: DB 'receiving...',0
3640BUFFER: DEFS 64
3650 DB 0,0,0,0
3660ZOIGIN: DB 'Bye...',13,10,0
3670MATRIX: DB 0,0FFH
3680 DB 'QWERTYUASDFGHJKZXCVBNM,'
3690 DB 0FFH,0FFH,0FFH,0FFH,9,32,10,11,14,15 ; LEFT RIGHT UP DOWN
3700 DB 0FFH, '0.=+',13,'L;',0FFH,'123-'
3710 DB 0FFH,'IO',0FFH,'456*',0FFH,'P',8,0FFH,'789/)'
3720 DB 0FFH,0FFH,0FFH,0FFH,'(',0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH
3730 DB 0,12,0FFH
3740ROWNUM: DB 0
3780RCVSTR: DB 'Receiving...',0,0

