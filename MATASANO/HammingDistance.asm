10 ORG 100H
20 JP MAIN
30WRASR EQU 0BFAFH
40PUTSTR EQU 0BFF1H
50INKEY EQU 089BEH
60PUTCHR EQU 0BE62H
70INITSR EQU 0871AH
80AOUT EQU 0BD09H
90OPENSR EQU 0BCE8H
100CLOSSR EQU 0BCEBH
110LRDSR EQU 0BD15H
120WAITK EQU 0BFCDH
130WCHRSR EQU 0BFAFH
140WSTSR EQU 0BFB2H
150A2HEX EQU 0F9BDH
160RPTCHR EQU 0BFEEH
170REGOUT EQU 0BD03H

200MAIN: CALL CLS
210 LD HL,GREET
220 CALL STRLN
230 LD DE,00000H
240 CALL PUTSTR
250 LD HL,TEXT0
260 CALL STRLN
270 LD DE,0200H
280 CALL PUTSTR
290 LD HL,TEXT1
300 CALL STRLN
310 LD DE,0300H
320 CALL PUTSTR
330 LD HL,TEXT0
340 LD DE,TEXT1
350 CALL HAMDIS
360 LD A,(COUNT)
370 LD HL,RSLT0
380 CALL HX2DEC
390 LD HL,RSLT
400 CALL STRLN
410 LD DE,0500H
420 CALL PUTSTR
430 CALL WAIT
440 CALL CLS

999 RET

1000HAMDIS: LD A,0
1010 LD (COUNT),A
1020HAMD01: LD A,(HL)
1030 CP 0
1040 JP Z,HAMEND
1050 LD A,(DE)
1060 XOR (HL)
1070 INC HL
1080 INC DE
1090 LD B,8
1100HAMD02: PUSH AF
1110 AND 1
1120 JP Z,HAMD00
1130 LD A,(COUNT)
1140 INC A
1150 LD (COUNT),A
1160HAMD00: POP AF
1170 RRCA
1180 DJNZ HAMD02
1190 JP HAMD01
1200HAMEND: RET

3000DEHEX: LD A,(DE)
3010 INC DE
3020 CALL HALF
3030 SLA A
3040 SLA A
3050 SLA A
3060 SLA A
3070 PUSH BC
3080 LD B,A
3090 LD A,(DE)
3100 INC DE
3110 CALL HALF
3120 ADD A,B
3130 LD (HL),A
3140 INC HL
3150 POP BC
3160 DJNZ DEHEX
3170 LD (HL),0
3180 RET

3190WAIT: CALL WAITK
3200 CP 0
3210 JP Z,WAIT
3220 RET

3230CLS: LD B,144
3240 LD DE,0
3250CLS0: LD A,32
3260 CALL RPTCHR
3270 RET
3280CLLN: LD B,24
3290 LD E,0
3300 JP CLS0

3310HEXIFY: PUSH AF
3320 AND 0F0H
3330 RRCA
3340 RRCA
3350 RRCA
3360 RRCA
3370 CALL NIBBLE
3380 INC HL
3390 POP AF
3400 AND 15
3410 CALL NIBBLE
3420 INC HL
3430 RET
3440NIBBLE: SUB 10
3450 JP M,ZERO9
3460 ADD A,7
3470ZERO9: ADD A,58
3480 LD (HL),A
3490 RET

3500STRLN: LD B,0
3510 PUSH HL
3520STRLN0: LD A,(HL)
3530 CP 0
3540 JP Z,STRLN1
3550 INC HL
3560 INC B
3570 JP STRLN0
3580STRLN1: POP HL
3590 RET

3600HALF: SUB 48
3610 CP 10
3620 JP M,HALF9
3630 SUB 7
3640HALF9: RET

4000HX2DEC: LD B,'0'
4010 LD (HL),B
4020HDEC00: LD (TMP),A
4030 CP 100
4040 JP M,HDEC01
4050 INC (HL)
4060 SUB 100
4070 JP HDEC00
4080HDEC01: INC HL
4090 LD B,'0'
4100 LD (HL),B
4110 LD A,(TMP)
4120HDEC02: LD (TMP),A
4130 CP 10
4140 JP M,HDEC03
4150 INC (HL)
4160 SUB 10
4170 JP HDEC02
4180HDEC03: INC HL
4185 LD A,(TMP)
4190 ADD A,48
4200 LD (HL),A
4210 RET

5000GREET: DB 'Matasano Challenge 6'
5010 DB 0
5020TEXT0: DB 'this is a test',0
5030TEXT1: DB 'wokka wokka!!!',0
5040COUNT: DB 0
5050TMP: DB 0
5060RSLT: DB 'Distance: '
5070RSLT0: DB 0,0,0
5080 DB ' [it'
5085 DB 39,'s 37]',0

